(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{568:function(l,t,e){"use strict";e.r(t);var c=e(0),b=Object(c.a)({},(function(){var l=this,t=l.$createElement,e=l._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":l.$parent.slotKey}},[e("h1",{attrs:{id:"setup-the-worker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setup-the-worker"}},[l._v("#")]),l._v(" Setup the Worker")]),l._v(" "),e("p",[l._v("The next thing we have to do is setup our worker handler. Our worker will listen to NewBlock events from tendermint (TX events can also be used if needed) . Every 3 blocks, it will query the ATOM/USDC price from Binance and submit the result. (Under the hood it will automatically submit a prevote first, and the actual claim in the following block).")]),l._v(" "),e("h2",{attrs:{id:"setup-worker-handler"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setup-worker-handler"}},[l._v("#")]),l._v(" Setup Worker Handler")]),l._v(" "),e("ul",[e("li",[l._v("Create a new folder "),e("code",[l._v("cmd/<yourapp>d/worker")])]),l._v(" "),e("li",[l._v("Inside, crate a file called "),e("code",[l._v("handlers.go")])])]),l._v(" "),e("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"cGFja2FnZSB3b3JrZXIKCmltcG9ydCAoCgkmcXVvdDtlbmNvZGluZy9qc29uJnF1b3Q7CgkmcXVvdDtmbXQmcXVvdDsKCSZxdW90O25ldC9odHRwJnF1b3Q7CgoJJnF1b3Q7Z2l0aHViLmNvbS9yZWxldmFudC1jb21tdW5pdHkvb3JhY2xlL3gvYXRvbS90eXBlcyZxdW90OwoJJnF1b3Q7Z2l0aHViLmNvbS9yZWxldmFudC1jb21tdW5pdHkvb3JhY2xlL3gvb3JhY2xlL2NsaWVudC9jbGkmcXVvdDsKCW9yYWNsZXR5cGVzICZxdW90O2dpdGh1Yi5jb20vcmVsZXZhbnQtY29tbXVuaXR5L29yYWNsZS94L29yYWNsZS90eXBlcyZxdW90OwoJcnBjdHlwZXMgJnF1b3Q7Z2l0aHViLmNvbS90ZW5kZXJtaW50L3RlbmRlcm1pbnQvcnBjL2NvcmUvdHlwZXMmcXVvdDsKCgkmcXVvdDtnaXRodWIuY29tL3NwZjEzL2NvYnJhJnF1b3Q7CikKCnR5cGUgQXRvbURhdGEgc3RydWN0IHsKCVN5bWJvbCBzdHJpbmcgYGpzb246JnF1b3Q7c3ltYm9sJnF1b3Q7YAoJUHJpY2UgIHN0cmluZyBganNvbjomcXVvdDtwcmljZSZxdW90O2AKfQoKLy8gSGFuZGxlVHggaXMgb3VyIGN1c3RvbSB0eCBoYW5kbGVyCmZ1bmMgSGFuZGxlVHgoY21kICpjb2JyYS5Db21tYW5kLCB0eEV2ZW50IHJwY3R5cGVzLlJlc3VsdEV2ZW50KSBlcnJvciB7CglyZXR1cm4gbmlsCn0KCi8vIEhhbmRsZUJsb2NrIGlzIG91ciBjdXN0b20gYmxvY2sgaGFuZGxlcgpmdW5jIEhhbmRsZUJsb2NrKGNtZCAqY29icmEuQ29tbWFuZCwgYmxvY2tFdmVudCBycGN0eXBlcy5SZXN1bHRFdmVudCkgZXJyb3IgewoJaGVscGVyLCBlcnIgOj0gY2xpLk5ld1dvcmtlckhlbHBlcihjbWQsIGJsb2NrRXZlbnQpCglpZiBlcnIgIT0gbmlsIHsKCQlyZXR1cm4gZXJyCgl9CgoJLy8gZm9yIGVhY2ggY2xhaW0gdHlwZSBpbiB0aGUgYXJyYXksIHJ1biB0aGUgYXBwcm9yaWF0ZSBoYW5kbGVyCglmb3IgXywgcGFyYW0gOj0gcmFuZ2UgaGVscGVyLk9yYWNsZVBhcmFtcy5DbGFpbVBhcmFtcyB7CgkJc3dpdGNoIHBhcmFtLkNsYWltVHlwZSB7CgkJY2FzZSB0eXBlcy5BdG9tQ2xhaW06CgkJCWdldEF0b21QcmljZShjbWQsIGhlbHBlciwgcGFyYW0pCgkJfQoJfQoKCXJldHVybiBuaWwKfQoKZnVuYyBnZXRBdG9tUHJpY2UoY21kICpjb2JyYS5Db21tYW5kLCBoZWxwZXIgKmNsaS5Xb3JrZXJIZWxwZXIsIHBhcmFtIG9yYWNsZXR5cGVzLkNsYWltUGFyYW1zKSBlcnJvciB7CgoJLy8gdXNlIFZvdGVQZXJpb2QgdG8gY2hlY2sgaWYgaXRzIHRpbWUgdG8gc3VibWl0IGEgY2xhaW0KCWlmIGhlbHBlci5Jc1JvdW5kU3RhcnQocGFyYW0uQ2xhaW1UeXBlKSA9PSBmYWxzZSB7CgkJcmV0dXJuIG5pbAoJfQoKCS8vIGZldGNoIEFUT00vVVNEQyBwYWlyIHByaWNlIGZyb20gQmluYW5jZQoJdmFyIGF0b21EYXRhID0gQXRvbURhdGF7fQoJciwgZXJyIDo9IGh0dHAuR2V0KCZxdW90O2h0dHBzOi8vYXBpLmJpbmFuY2UuY29tL2FwaS92My90aWNrZXIvcHJpY2U/c3ltYm9sPUFUT01VU0RDJnF1b3Q7KQoJaWYgZXJyICE9IG5pbCB7CgkJZm10LlByaW50bG4oJnF1b3Q7RXJyb3IgZmV0Y2hpbmcgQVRPTSBwcmljZSZxdW90OykKCQlyZXR1cm4gZXJyCgl9CglkZWZlciByLkJvZHkuQ2xvc2UoKQoJanNvbi5OZXdEZWNvZGVyKHIuQm9keSkuRGVjb2RlKCZhbXA7YXRvbURhdGEpCgoJLy8gY3JlYXRlIGEgQ2xhaW0gYWJvdXQgQXRvbVVTRCBwcmljZQoJYXRvbVVzZCA6PSB0eXBlcy5OZXdBdG9tVXNkKGhlbHBlci5CbG9ja0hlaWdodCwgYXRvbURhdGEuUHJpY2UpCgoJLy8gcnVuIHByb2Nlc3MgZm9yIHRoZSBnaXZlbiBjbGFpbVR5cGUKCWlmIGF0b21Vc2QgPT0gbmlsIHsKCQlmbXQuUHJpbnRsbigmcXVvdDtFcnJvciBjcmVhdGluZyBjbGFpbSZxdW90OykKCQlyZXR1cm4gbmlsCgl9CgoJLy8gc3VibWl0IG91ciBjbGFpbQoJaGVscGVyLlN1Ym1pdFdvcmtlclR4KGF0b21Vc2QpCglyZXR1cm4gbmlsCn0K"}}),l._v(" "),e("h2",{attrs:{id:"attach-our-handlers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#attach-our-handlers"}},[l._v("#")]),l._v(" Attach Our Handlers")]),l._v(" "),e("p",[l._v("We need to tell the Oracle module about our worker code. To do this, navigatate to the "),e("code",[l._v("cmd/<your_app>d/cmd/root.go")]),l._v(" file.")]),l._v(" "),e("ol",[e("li",[l._v("Import the Oracle module CLI package")])]),l._v(" "),e("p",[l._v("add this line to the "),e("code",[l._v("initRootCmd")]),l._v(" method before "),e("code",[l._v("rootCmd.AddCommand")])]),l._v(" "),e("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBpbml0Um9vdENtZChyb290Q21kICpjb2JyYS5Db21tYW5kLCBlbmNvZGluZ0NvbmZpZyBwYXJhbXMuRW5jb2RpbmdDb25maWcpIHsKCS4uLgoJb3JhY2xlY2xpLkluaXRpYWxpemVXb3JrZXIod29ya2VyLkhhbmRsZUJsb2NrLCB3b3JrZXIuSGFuZGxlVHgpCgoJLy8gYWRkIGtleWJhc2UsIGF1eGlsaWFyeSBSUEMsIHF1ZXJ5LCBhbmQgdHggY2hpbGQgY29tbWFuZHMKCXJvb3RDbWQuQWRkQ29tbWFuZCgKCQlycGMuU3RhdHVzQ29tbWFuZCgpLAoJCXF1ZXJ5Q29tbWFuZCgpLAoJCXR4Q29tbWFuZCgpLAoJCWtleXMuQ29tbWFuZHMoYXBwLkRlZmF1bHROb2RlSG9tZSksCgkpCn0K"}}),l._v(" "),e("p",[l._v("(make sure to import "),e("code",[l._v('oraclecli "github.com/relevant-community/oracle/x/oracle/client/cli"')]),l._v(")\n)")]),l._v(" "),e("h2",{attrs:{id:"run-the-worker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#run-the-worker"}},[l._v("#")]),l._v(" Run the Worker!")]),l._v(" "),e("p",[l._v("We should now be able to run our worker!")]),l._v(" "),e("p",[l._v("From a new terminal window, run:")]),l._v(" "),e("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"JCAmbHQ7eW91cl9hcHBkJmd0OyB0eCBvcmFjbGUgc3RhcnQtd29ya2VyIC0tZnJvbSBhbGljZSAtbyB0ZXh0IC15Cg=="}}),l._v(" "),e("p",[l._v("*replace alice with your app's validator address if needed")]),l._v(" "),e("p",[l._v("You should see some transaction logs in your terminal.")]),l._v(" "),e("p",[l._v("Try querying the oracle state:")]),l._v(" "),e("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"JCAmbHQ7eW91cl9hcHBkJmd0OyBxdWVyeSBvcmFjbGUgYWxsLWNsYWltcwokICZsdDt5b3VyX2FwcGQmZ3Q7IHF1ZXJ5IG9yYWNsZSBwZW5kaW5nLXJvdW5kcyBBdG9tQ2xhaW0KJCAmbHQ7eW91cl9hcHBkJmd0OyBxdWVyeSBvcmFjbGUgYWxsLXJvdW5kcwo="}})],1)}),[],!1,null,null,null);t.default=b.exports}}]);